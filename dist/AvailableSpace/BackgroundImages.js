(function(window){"use strict";function AvailableSpaceBackgroundImages(params){this.settings={querySelector:'[data-available-space-background-image]',onInit:null,onImageLoaded:null};if(typeof params==="object"){for(var key in params){if(params.hasOwnProperty(key)&&typeof this.settings[key]!=="undefined"){this.settings[key]=params[key]}}}
this.devicePixelRatio=window.devicePixelRatio||1;this.imageSets=[];this.observer=null;this.imageCollection=document.querySelectorAll(this.settings.querySelector);this.init()}
AvailableSpaceBackgroundImages.prototype={isExplorer:function(){return document.documentMode||/Edge/.test(navigator.userAgent)},isInIframe:function(){try{return window.self!==window.top}catch(e){return!0}},init:function(){var self=this;var iNum=0;for(var i=0;i<this.imageCollection.length;i++){var img=this.imageCollection[i];var sourceSet=[];for(var a=0;a<img.attributes.length;a++){var ia=img.attributes[a];if(ia.nodeName.indexOf("data-src-")===0){var k=parseInt(ia.nodeName.replace("data-src-",""));if(k){sourceSet.push({width:k,src:ia.nodeValue})}}}
sourceSet.sort(function(a,b){var r=0;if(a.width>b.width){r=1}else if(b.width>a.width){r=-1}
return r});img.setAttribute("data-src-num",iNum);this.imageSets[iNum]={sourceSet:sourceSet,image:img,loadingImage:null};iNum++}
if(typeof this.settings.onInit==="function"){this.settings.onInit(this)}
if(!window.IntersectionObserver||(this.isExplorer()&&this.isInIframe())){for(var i=0;i<this.imageSets.length;i++){this.loadImage(this.imageSets[i].image)}
return}
this.observer=new IntersectionObserver(function(entries){for(var i=0;i<entries.length;i++){if(entries[i].intersectionRatio>0){self.loadImage(entries[i].target)}}},{root:null,rootMargin:"0px",threshold:[0]});for(var i=0;i<this.imageSets.length;i++){this.observer.observe(this.imageSets[i].image)}},getBestImageSrc:function(imageSet){var targetWidth=imageSet.image.parentNode.clientWidth*this.devicePixelRatio;for(var i=0;i<imageSet.sourceSet.length;i++){if(targetWidth<imageSet.sourceSet[i].width){return imageSet.sourceSet[i].src}}
return imageSet.sourceSet[imageSet.sourceSet.length-1].src},loadImage:function(image){var n=parseInt(image.getAttribute("data-src-num")),is=this.imageSets[n],newSrc=this.getBestImageSrc(is),self=this;if(newSrc!==image.getAttribute("src")){is.loadingImage=new Image();is.loadingImage.setAttribute("src",newSrc);is.loadingImage.setAttribute("data-src-num",n);is.loadingImage.addEventListener("load",function(evt){var m=parseInt(evt.target.getAttribute("data-src-num"));if(self.imageSets[m]){var imgSet=self.imageSets[m];imgSet.image.style.backgroundImage="url("+evt.target.getAttribute("src")+")";if(imgSet.image.hasAttribute("data-onimageloaded")&&typeof self.settings.onImageLoaded==="function"){self.settings.onImageLoaded(imgSet,imgSet.image.getAttribute("data-onimageloaded"))}}})}}};if(typeof define==="function"&&define.amd){define(function(){return AvailableSpaceBackgroundImages})}else{window.AvailableSpaceBackgroundImages=AvailableSpaceBackgroundImages}})(window)